import numpy as np
import pandas as pd


def df_to_matrix(df):
    """
    convert from pandas dataframe to scipy sparse matrix or numpy array
    """
    sparse = [_type for _, _type in df.dtypes.items() if "Sparse" in _type.name]

    if sparse:
        df = df.astype(pd.SparseDtype(dtype=np.float32, fill_value=0))
        return df.sparse.to_coo().tocsr()
    else:
        return df.to_numpy()