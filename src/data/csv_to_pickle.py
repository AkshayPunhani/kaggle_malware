import pandas as pd
from pathlib import Path
from tqdm import tqdm
import json


def csv_to_pickle(csv_paths, dtypes):
    """
    convert csv in the given paths to pickle
    """
    # convert
    for csv_path in tqdm(list(csv_paths)):
        pd.read_csv(str(csv_path), encoding='utf-8', dtype=dtypes).to_pickle(str(csv_path).replace("csv", "pkl"))


if __name__ == '__main__':

    # csv path
    root_path = Path('..', '..', 'data', 'input')
    csv_paths = root_path.glob('*.csv')

    # data types
    dtypes_path = Path(root_path, 'dtypes.json')
    with open(dtypes_path) as f:
        dtypes = json.load(f)

    csv_to_pickle(csv_paths=csv_paths, dtypes=dtypes)
