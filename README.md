# Data Science Workshop: Microsoft Malware Prediction Competition at kaggle

30GB+ memory space is required to run the entire code with random forest (default parameters of sklearn). More complicated models or different parameters may need more memory space.

## Environment Setup
Install pipenv for package and version control.

``
$ pip install pipenv 
``

Run the following command at the top project directory to create and activate virtual environment with packages in Pipfile and Pipfile.lock.

``
$ pipenv install
$ pipenv shell
``

## Download Dataset
Install kaggle API and run the following command to download dataset.

```
$ cd data/input
$ kaggle competitions download -c microsoft-malware-prediction
```

## Dataset Conversion
Convert input data from csv format to pickle format to save loading and saving time.

```
$ cd src/data
$ python csv_to_pickle.py
```

`.pkl` format files would be saved at `data/input/`

In `csv_to_pickle.py`, `data/input/dtypes.json` is used to save loading time and reduce memory usage by designating appropriate data type for each features. `dtypes.json` is based on [https://www.kaggle.com/theoviel/load-the-totality-of-the-data](https://www.kaggle.com/theoviel/load-the-totality-of-the-data).

## Feature Engineering
Add a new subclass of `Feature` (defined at `src/features/Feature.py`) in `src/features/feature_classes` to create a new feature. Class name would be used as file name (i.e. AllLabelEncoding -> all_label_encoding.pkl).

```
$ cd src/features
$ python create_features.py [-f]
```
`-f`: Overwrite existing files at `data/features/`

Pickle files including created features would be saved at `data/features/`.

## Train Model
Create a new configuration file as `{file_name}.json` foramt following `configs/default.json`, which includes model information, selected features, cross validation params, etc...

```
$ cd src/models
$ python train_model.py [-d] [-c "{file_name}.json"]
```

`-d`: Debug mode. Using only first 1% of train and test data

`-c`: Directory of configuration json file. Default is `default.json`

Each output would be saved at the following directories:

Submission file (prediction on kaggle test data): `data/output/sub_{data}_{cv_score}.csv`

Prediction on cross validation test data: `data/output/val_{data}_{cv_score}.pkl`

Feature importance (graph): `figures/feature_importance/importances_{data}_{cv_score}.png` 

Feature importance (raw data): `data/output/importances_{data}_{cv_score}.pkl`

Trained models : `models/___` * not implemented yet

## References
- [LightGBM. Baseline Model Using Sparse Matrix (kaggle kernel)](https://www.kaggle.com/bogorodvo/lightgbm-baseline-model-using-sparse-matrix)

- [ml-competition-template-titanic (github)](https://github.com/upura/ml-competition-template-titanic)
